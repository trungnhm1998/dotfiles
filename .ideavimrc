" ==================================================================================
" LEADER KEYS & CORE SETTINGS
" ==================================================================================

" Unmap space to prevent cursor movement, then set as leader
nnoremap <space> <Nop>
let mapleader="\<Space>"
let maplocalleader = "\\"

" ==================================================================================
" VIM BASIC SETTINGS
" ==================================================================================

" Visual & Display
set number
set relativenumber
set showmode
set showcmd
set visualbell

" Search Settings
set hlsearch
set incsearch
set ignorecase
set smartcase

" Behavior
set scrolloff=5
set so=5
set history=1000
set clipboard+=unnamed
set exchange

" Plugin: Highlighted Yank Configuration
let g:highlightedyank_highlight_duration = 500

" ==================================================================================
" IDEAVIM SPECIFIC SETTINGS
" ==================================================================================

set notimeout
set ideajoin
set ideamarks
set ideastatusicon=gray
set idearefactormode=normal

" ==================================================================================
" PLUGINS
" ==================================================================================

set multiple-cursors
set commentary
set NERDTree
set easymotion
set surround
set textobj-entire
set ReplaceWithRegister
set sneak
set highlightedyank
set which-key
set quickscope
set mini-ai
set functiontextobj
set argtextobj
set peekaboo
set anyobject

" ==================================================================================
" CORE VIM REMAPS
" ==================================================================================
nmap <leader>l <Action>(VimActions)

" Visual Mode: Paste without losing clipboard contents
" Deletes highlighted text to void register, then pastes
vnoremap <leader>pp "_dP

" Search: Clear highlights with Escape
nnoremap <Esc> :nohl<CR>
inoremap <Esc> <Esc>:nohl<CR>
snoremap <Esc> <Esc>:nohl<CR>

" ==================================================================================
" WINDOW, TAB & BUFFER MANAGEMENT
" ==================================================================================

" Window Navigation (Ctrl + hjkl)
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Window Commands
" Resizing
nmap <leader>w+ <Action>(StretchSplitToTop)
nmap <leader>w- <Action>(StretchSplitToBottom)
nmap <leader>w< <Action>(StretchSplitToLeft)
nmap <leader>w> <Action>(StretchSplitToRight)

nmap <C-Up> <Action>(StretchSplitToTop)
nmap <C-Down> <Action>(StretchSplitToBottom)
nmap <C-Left> <Action>(StretchSplitToLeft)
nmap <C-Right> <Action>(StretchSplitToRight)

nmap <leader>wm <Action>(MaximizeEditorInSplit)
nmap <leader>uZ <Action>(MaximizeEditorInSplit)

nmap <leader>wu <Action>(UnsplitAll)
nmap <leader>wT <Action>(Unsplit)
nmap <leader>wx <Action>(MoveEditorToOppositeTabGroup)

nmap <leader>w <c-w>
nmap <leader>ww <c-w>w
nmap <leader>wd <c-w>c
nmap <C-W>q :q<CR>

" Tab Navigation
nnoremap <S-h> gT
nnoremap <S-l> gt

" Buffer Management
nmap <leader>bd <Action>(CloseContent)
nmap <leader>bD <Action>(CloseAllEditors)
nmap <leader>bo <Action>(CloseAllEditorsButActive)
nmap <leader>bk <Action>(KeepTabOpen)
nmap <leader>, <Action>(RecentFiles)
nmap <leader>fr <Action>(RecentFiles)

" ==================================================================================
" FILE & PROJECT NAVIGATION
" ==================================================================================

nmap <leader>fn <Action>(NewElement)
nmap <leader>fN <Action>(NewElementSamePlace)
nmap <leader>ff <Action>(GotoFile)
nmap <leader><Space> <Action>(GotoFile)
nmap <leader>sg <Action>(FindInPath)
nmap <leader>s <Action>(SelectInProjectView)
nmap <leader>sa <Action>(GotoAction)
nmap <leader>ss <Action>(FileStructurePopup)
nmap <leader>o <Action>(FileStructurePopup)
nnoremap <leader>e :NERDTreeToggle<CR>

xmap <Leader>sw <Action>(FindInPath)
xmap <Leader>sW <Action>(FindInPath)

" replace with register plugin
nmap <Leader>gr  <Plug>ReplaceWithRegisterOperator
nmap <Leader>grr <Plug>ReplaceWithRegisterLine
xmap <Leader>gr  <Plug>ReplaceWithRegisterVisual

" ==================================================================================
" CODE NAVIGATION
" ==================================================================================

" Go to...
nmap gh <Action>(QuickJavaDoc)
nnoremap gr <Action>(FindUsages)
nmap gR <Action>(FindUsages)
nmap gu <Action>(ShowUsages)
nmap gi <Action>(GotoImplementation)
nmap gI <Action>(QuickImplementations)
nmap gD <Action>(GotoTypeDeclaration)
nmap gd <Action>(GotoDeclaration)
nmap gn <Action>(ShowNavBar)

" Actions & Errors
" nmap ge <Action>(ShowErrorDescription)
" nmap gq <Action>(ShowIntentionActions)
nmap <leader>uu <Action>(HideAllWindows)
nmap <leader>xx <Action>(ActivateProblemsViewToolWindow)
nmap <leader>se <Action>(Rider.ProblemsView.ErrorsInSolution)

" Error Navigation
nmap <S-Space> <Action>(GotoNextError)
nmap ]e <Action>(ReSharperGotoNextErrorInSolution)
nmap [e <Action>(ReSharperGotoPrevErrorInSolution)
nmap ]d <Action>(GotoNextError)
nmap [d <Action>(GotoPreviousError)

" Jump List Navigation
nmap <C-o> <Action>(Back)
nmap <C-i> <Action>(Forward)

" ==================================================================================
" CODE ACTIONS (LSP-LIKE)
" ==================================================================================

nmap K <Action>(ShowHoverInfo)
nmap <leader>cr <Action>(RenameElement)
nmap <leader>cf <Action>(ReformatCode)
nmap <leader>r <Action>(Refactorings.QuickListPopupAction)
vmap <leader>r <Action>(Refactorings.QuickListPopupAction)
xmap <leader>r <Action>(Refactorings.QuickListPopupAction)
smap <leader>r <Action>(Refactorings.QuickListPopupAction)

" Specific Refactorings
vmap <leader>rp <Action>(IntroduceParameter)
vmap <leader>rv <Action>(IntroduceVariable)
vmap <leader>rm <Action>(ExtractMethod)
vmap <leader>rf <Action>(IntroduceField)

" Imports
nmap <leader>oi <Action>(OptimizeImports)

" ==================================================================================
" GIT / VERSION CONTROL
" ==================================================================================

" Git Blame & Annotations
nmap <leader>gb <Action>(Annotate)
nmap <leader>ghb <Action>(GitToolBox.BlameDetails)

" VCS History & Changes
nmap <leader>h <Action>(Vcs.ShowTabbedFileHistory)
nmap <leader>gg <Action>(ActivateCommitToolWindow)

" Change Markers Navigation
nmap ]h <Action>(VcsShowNextChangeMarker)
nmap [h <Action>(VcsShowPrevChangeMarker)

" ==================================================================================
" DEBUGGING
" ==================================================================================

nmap <leader>db <Action>(ToggleLineBreakpoint)
nmap <leader>dB <Action>(ViewBreakpoints)
nmap <leader>dc <Action>(Resume)
nmap <leader>di <Action>(StepInto)
nmap <leader>do <Action>(StepOut)
nmap <leader>dt <Action>(Stop)
nmap <leader>dd <Action>(Debug)
nmap <leader>dC <Action>(RunToCursor)
nmap <leader>dw <Action>(ActivateDebugToolWindow)

" ==================================================================================
" UNIT TESTING
" ==================================================================================

if &ide =~? 'JetBrains Rider'
    nmap <leader>tr <Action>(RiderUnitTestRunContextAction)
    nmap <leader>tT <Action>(RiderUnitTestRunSolutionAction)
    nmap <leader>tl <Action>(RiderUnitTestRepeatPreviousRunAction)
    nmap <leader>td <Action>(RiderUnitTestDebugContextAction)
endif
nmap <leader>to <Action>(ActivateUnitTestsToolWindow)
nmap <leader>ts <Action>(ActivateUnitTestsToolWindow)

" ==================================================================================
" UI & EDITOR TOGGLES
" ==================================================================================

" Editor Display
nmap <leader>uz <Action>(ToggleZenMode)
nmap <leader>uw <Action>(EditorToggleUseSoftWraps)
nmap <leader>ul <Action>(EditorGutterToggleGlobalLineNumbers)

" Terminal
nmap <leader>ft <Action>(ActivateTerminalToolWindow)
nmap <C-/> <Action>(ActivateTerminalToolWindow)

" ==================================================================================
" ADVANCED FEATURES
" ==================================================================================

" Multiple Cursors (matching terryma/vim-multiple-cursors)
nmap <C-n> <Plug>NextWholeOccurrence
xmap <C-n> <Plug>NextWholeOccurrence
nmap g<C-n> <Plug>NextOccurrence
xmap g<C-n> <Plug>NextOccurrence
xmap <C-x> <Plug>SkipOccurrence
xmap <C-p> <Plug>RemoveOccurrence
nmap <leader><C-n> <Plug>AllWholeOccurrences
xmap <leader><C-n> <Plug>AllWholeOccurrences
nmap <leader>g<C-n> <Plug>AllOccurrences
xmap <leader>g<C-n> <Plug>AllOccurrences

" AI / Copilot
nmap <leader>aa <Action>(copilot.chat.show)
nmap <leader>aq <Action>(copilot.chat.inline)
vmap <leader>aa <Action>(copilot.chat.show)
vmap <leader>aq <Action>(copilot.chat.inline)

" ==================================================================================
" KEY HANDLER CONFLICTS
" ==================================================================================
" Controls whether IDE or Vim handles specific key combinations
" Format: sethandler <key> a:ide (IDE handles all modes)
"         sethandler <key> n:vim i-x-v:ide (Vim in normal, IDE in insert/visual)

" IDE Handles All Modes
sethandler <C-2> a:ide
sethandler <C-6> a:ide
sethandler <C-A> a:ide
sethandler <C-C> a:ide
sethandler <C-E> a:ide
sethandler <C-G> a:ide
sethandler <C-M> a:ide
sethandler <C-S> a:ide
sethandler <C-S-2> a:ide
sethandler <C-S-6> a:ide
sethandler <C-T> a:ide
sethandler <C-X> a:ide
sethandler <C-Y> a:ide
sethandler <C-[> a:ide
sethandler <C-\> a:ide
sethandler <C-]> a:ide
sethandler <S-j> a:ide

" Vim in Normal Mode, IDE in Insert/Visual (for window navigation)
sethandler <C-H> n:vim i-x-v:ide
sethandler <C-J> n:vim i-x-v:ide
sethandler <C-K> n:vim i-x-v:ide
sethandler <C-L> n:vim i-x-v:ide

" Vim Handles All Modes (core Vim functionality)
sethandler <C-B> a:vim
sethandler <C-D> a:vim
sethandler <C-F> n:vim i-x-v:ide
sethandler <C-I> a:vim
sethandler <C-N> a:vim
sethandler <C-O> a:vim
sethandler <C-P> a:vim
sethandler <C-R> a:vim
sethandler <C-U> a:vim
sethandler <C-V> a:vim
sethandler <C-W> a:vim
