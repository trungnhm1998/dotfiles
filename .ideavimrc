" ==================================================================================
" LEADER KEYS & CORE SETTINGS
" ==================================================================================

" Unmap space to prevent cursor movement, then set as leader
nnoremap <space> <Nop>
let mapleader="\<Space>"
let maplocalleader = "\\"

" ==================================================================================
" VIM BASIC SETTINGS
" ==================================================================================

" Visual & Display
set number
set relativenumber
set showmode
set showcmd
set visualbell

" Search Settings
set hlsearch
set incsearch
set ignorecase
set smartcase

" Behavior
set scrolloff=5
set so=5
set history=1000
set clipboard+=unnamed
set exchange

" Plugin: Highlighted Yank Configuration
let g:highlightedyank_highlight_duration = 500

" ==================================================================================
" IDEAVIM SPECIFIC SETTINGS
" ==================================================================================

set notimeout
set ideajoin
set ideastatusicon=gray
set idearefactormode=keep

" ==================================================================================
" PLUGINS
" ==================================================================================

set multiple-cursors
set commentary
set NERDTree
set easymotion
set surround
set textobj-entire
set ReplaceWithRegister
set sneak
set highlightedyank
set which-key
set quickscope
set mini-ai
set functiontextobj
set argtextobj
set peekaboo

" ==================================================================================
" CORE VIM REMAPS
" ==================================================================================

" Visual Mode: Paste without losing clipboard contents
" Deletes highlighted text to void register, then pastes
vnoremap <leader>pp "_dP

" Search: Clear highlights with Escape
nnoremap <Esc> :nohl<CR>
inoremap <Esc> <Esc>:nohl<CR>
snoremap <Esc> <Esc>:nohl<CR>

" ==================================================================================
" WINDOW, TAB & BUFFER MANAGEMENT
" ==================================================================================

" Window Navigation (Ctrl + hjkl)
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Window Commands
map <leader>w <c-w>
map <leader>wd <c-w>c
map <C-W>q :q<CR>
map <leader>z <Action>(MaximizeEditorInSplit)
inoremap <C-v> <Action>(RiderEditSourceInRightSplit)

" Tab Navigation
nnoremap <S-h> gT
nnoremap <S-l> gt

" Buffer Management
map <leader>bd <Action>(CloseContent)
map <leader>bD <Action>(CloseAllEditors)
map <leader>bo <Action>(CloseAllEditorsButActive)
map <leader>bk <Action>(KeepTabOpen)

" ==================================================================================
" FILE & PROJECT NAVIGATION
" ==================================================================================

map <leader>ff <Action>(GotoFile)
map <leader>sg <Action>(FindInPath)
map <leader>s <Action>(SelectInProjectView)
map <leader>ss <Action>(FileStructurePopup)
map <leader>o <Action>(FileStructurePopup)
nnoremap <leader>e :NERDTreeToggle<CR>

" ==================================================================================
" CODE NAVIGATION
" ==================================================================================

" Go to...
map gh <Action>(QuickJavaDoc)
map gr <Action>(FindUsages)
map gI <Action>(GotoImplementation)
map gy <Action>(GotoTypeDeclaration)

" Quick Peek
map gpi <Action>(QuickImplementations)
map gpd <Action>(QuickImplementations)

" Actions & Errors
map ge <Action>(ShowErrorDescription)
map gq <Action>(ShowIntentionActions)
map gm <Action>(HideAllWindows)

" Error Navigation
map <S-Space> <Action>(GotoNextError)
map ]e <Action>(ReSharperGotoNextErrorInSolution)
map [e <Action>(ReSharperGotoPrevErrorInSolution)

" ==================================================================================
" CODE ACTIONS (LSP-LIKE)
" ==================================================================================

map K <Action>(ShowHoverInfo)
map <leader>cr <Action>(RenameElement)
map <leader>cf <Action>(ReformatCode)
vmap <leader>r <Action>(Refactorings.QuickListPopupAction)

" CODE Refactorings

" parameter or argument using p or a?
vmap <leader>rp <Action>(IntroduceParameter)
vmap <leader>rv <Action>(IntroduceVariable)
vmap <leader>rm <Action>(ExtractMethod)
vmap <leader>rf <Action>(IntroduceField)

" ==================================================================================
" GIT / VERSION CONTROL
" ==================================================================================

" Git Blame & Annotations
map <leader>gb <Action>(Annotate)
map <leader>ghb <Action>(GitToolBox.BlameDetails)

" VCS History & Changes
map <leader>h <Action>(Vcs.ShowTabbedFileHistory)
map <leader>gg <Action>(ActivateCommitToolWindow)

" Change Markers Navigation
map ]h <Action>(VcsShowNextChangeMarker)
map [h <Action>(VcsShowPrevChangeMarker)

" ==================================================================================
" DEBUGGING
" ==================================================================================

map <leader>d <Action>(Debug)
map <leader>c <Action>(Stop)
map <leader>db <Action>(ToggleLineBreakpoint)

" ==================================================================================
" UI & EDITOR TOGGLES
" ==================================================================================

map <leader>uz <Action>(ToggleZenMode)
map <leader>uw <Action>(EditorToggleUseSoftWraps)
" For zen mode
nmap <leader>ul <Action>(EditorGutterToggleGlobalLineNumbers)

" Terminal
map <leader>fT <Action>(ActivateTerminalToolWindow)
map <C-/> <Action>(ActivateTerminalToolWindow)

" ==================================================================================
" ADVANCED FEATURES
" ==================================================================================

" Multiple Cursors (matching terryma/vim-multiple-cursors)
nmap <C-n> <Plug>NextWholeOccurrence
xmap <C-n> <Plug>NextWholeOccurrence
nmap g<C-n> <Plug>NextOccurrence
xmap g<C-n> <Plug>NextOccurrence
xmap <C-x> <Plug>SkipOccurrence
xmap <C-p> <Plug>RemoveOccurrence
nmap <leader><C-n> <Plug>AllWholeOccurrences
xmap <leader><C-n> <Plug>AllWholeOccurrences
nmap <leader>g<C-n> <Plug>AllOccurrences
xmap <leader>g<C-n> <Plug>AllOccurrences

" Popup Menu Navigation
inoremap <C-j> <Action>(PopupMenu-selectNext)
inoremap <C-k> <Action>(PopupMenu-selectPrev)

" AI / Copilot
map <leader>aa <Action>(copilot.chat.show)
map <leader>aq <Action>(copilot.chat.inline)

" ==================================================================================
" KEY HANDLER CONFLICTS
" ==================================================================================
" Controls whether IDE or Vim handles specific key combinations
" Format: sethandler <key> a:ide (IDE handles all modes)
"         sethandler <key> n:vim i-x-v:ide (Vim in normal, IDE in insert/visual)

" IDE Handles All Modes
sethandler <C-2> a:ide
sethandler <C-S-2> a:ide
sethandler <C-6> a:ide
sethandler <C-S-6> a:ide
sethandler <C-A> a:ide
sethandler <C-C> a:ide
sethandler <C-E> a:ide
sethandler <C-G> a:ide
sethandler <C-M> a:ide
sethandler <C-S> a:ide
sethandler <C-T> a:ide
sethandler <C-X> a:ide
sethandler <C-Y> a:ide
sethandler <C-[> a:ide
sethandler <C-\> a:ide
sethandler <C-]> a:ide
sethandler <C-P> a:ide
sethandler <S-j> a:ide

" Vim in Normal Mode, IDE in Insert/Visual (for window navigation)
sethandler <C-H> n:vim i-x-v:ide
sethandler <C-J> n:vim i-x-v:ide
sethandler <C-K> n:vim i-x-v:ide
sethandler <C-L> n:vim i-x-v:ide

" Vim Handles All Modes (core Vim functionality)
sethandler <C-I> a:vim
sethandler <C-B> a:vim
sethandler <C-D> a:vim
sethandler <C-F> n:vim i-x-v:ide 
sethandler <C-N> a:vim
sethandler <C-O> a:vim
sethandler <C-R> a:vim
sethandler <C-U> a:vim
sethandler <C-V> a:vim
sethandler <C-W> a:vim

" __AUTO_GENERATED_PRINT_VAR_START__
echom ' ?:' ?| " __AUTO_GENERATED_PRINT_VAR_END__
